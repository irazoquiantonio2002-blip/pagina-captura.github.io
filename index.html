<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J79YNCPYN6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J79YNCPYN6');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Protocolo de Automatización | Oly System</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

    :root{
      /* OLY Systems Dark Brand Tokens */
      --oly-orange: #F97316;
      --oly-orange-deep: #EA580C;
      --oly-orange-soft: #FB923C;

      --oly-bg: #0B0F16;              /* deep ink */
      --oly-surface: rgba(255,255,255,0.06);
      --oly-surface-2: rgba(255,255,255,0.09);
      --oly-glass: rgba(255,255,255,0.08);
      --oly-stroke: rgba(255,255,255,0.10);
      --oly-stroke-2: rgba(255,255,255,0.06);

      --oly-text: rgba(255,255,255,0.92);
      --oly-text-2: rgba(255,255,255,0.70);
      --oly-text-3: rgba(255,255,255,0.55);

      --oly-shadow: 0 20px 40px -10px rgba(0,0,0,0.55);
      --oly-shadow-2: 0 28px 90px -28px rgba(0,0,0,0.75);

      --oly-accent-gradient: linear-gradient(135deg, var(--oly-orange) 0%, var(--oly-orange-deep) 100%);
      --oly-accent-glow: 0 18px 60px rgba(249,115,22,0.22);
      --oly-accent-glow-2: 0 24px 90px rgba(249,115,22,0.18);
    }

    body{
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: var(--oly-bg);
      color: var(--oly-text);
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    /* Background */
    .studio-background{
      position: fixed;
      inset: 0;
      z-index: -2;
      background:
        radial-gradient(circle at 50% 0%, rgba(249,115,22,0.18) 0%, rgba(249,115,22,0.06) 28%, rgba(11,15,22,0) 55%),
        radial-gradient(circle at 0% 100%, rgba(234,88,12,0.16) 0%, rgba(234,88,12,0) 60%),
        radial-gradient(circle at 100% 55%, rgba(251,146,60,0.10) 0%, rgba(251,146,60,0) 55%),
        linear-gradient(180deg, #0B0F16 0%, #070A10 100%);
    }

    .flare-container{
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
      pointer-events: none;
    }

    .silver-flare{
      position: absolute;
      border-radius: 50%;
      filter: blur(120px);
      opacity: 0.35;
      background: radial-gradient(circle, rgba(249,115,22,0.32) 0%, rgba(249,115,22,0) 70%);
    }

    .flare-1{ width: 680px; height: 680px; top: -240px; left: -160px; animation: move 20s infinite alternate; }
    .flare-2{ width: 820px; height: 820px; bottom: -260px; right: -210px; animation: move 25s infinite alternate-reverse; }

    @keyframes move{
      from{ transform: translate(0,0) scale(1); }
      to{ transform: translate(80px,120px) scale(1.12); }
    }

    /* Headline gradient (dark) */
    .mercury-text{
      background: linear-gradient(180deg, rgba(255,255,255,0.96) 0%, rgba(255,255,255,0.72) 45%, rgba(255,255,255,0.42) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 2px 10px rgba(0,0,0,0.45));
    }

    /* Glass panels */
    .mercury-glass-panel{
      background: var(--oly-glass);
      backdrop-filter: blur(44px) saturate(160%);
      -webkit-backdrop-filter: blur(44px) saturate(160%);
      border: 1px solid var(--oly-stroke);
      box-shadow: var(--oly-shadow);
    }

    /* Primary button */
    .btn-mercury{
      background: var(--oly-accent-gradient);
      color: #fff;
      box-shadow: var(--oly-accent-glow);
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .btn-mercury:hover:not(:disabled){
      transform: translateY(-2px);
      box-shadow: var(--oly-accent-glow-2);
      filter: brightness(1.06);
    }

    .btn-mercury:active:not(:disabled){
      transform: translateY(0) scale(0.98);
    }

    /* Inputs */
    .glass-input{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      backdrop-filter: blur(12px);
      color: var(--oly-text);
      transition: all 0.3s ease;
    }

    .glass-input::placeholder{
      color: rgba(255,255,255,0.42);
    }

    .glass-input:focus{
      background: rgba(255,255,255,0.08);
      border-color: rgba(249,115,22,0.60);
      box-shadow: 0 0 0 5px rgba(249,115,22,0.16);
    }

    /* Selected option */
    .active-option{
      background: rgba(255,255,255,0.10) !important;
      border-color: rgba(249,115,22,0.55) !important;
      box-shadow: 0 18px 45px -18px rgba(0,0,0,0.65) !important;
    }

    .step-transition{
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    /* badges look */
    .ideal-badge{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 12px 28px rgba(0,0,0,0.40);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
      color: rgba(255,255,255,0.70);
    }
    .ideal-badge:hover{
      transform: translateY(-2px);
      border-color: rgba(249,115,22,0.20);
      box-shadow: 0 18px 48px rgba(0,0,0,0.55);
    }
  </style>
</head>

<body class="antialiased selection:bg-orange-500/20">
  <div class="studio-background"></div>
  <div class="flare-container">
    <div class="silver-flare flare-1"></div>
    <div class="silver-flare flare-2"></div>
  </div>

  <!-- HEADER / LOGO -->
  <nav class="fixed top-0 w-full z-40 px-6 py-6 flex justify-between items-center pointer-events-none">
    <div class="flex items-center gap-2 pointer-events-auto">
      <div class="w-10 h-10 rounded-xl flex items-center justify-center shadow-lg"
           style="background: var(--oly-accent-gradient); box-shadow: var(--oly-accent-glow);">
        <i data-lucide="cpu" class="text-white w-5 h-5"></i>
      </div>
      <span class="font-extrabold tracking-tighter text-xl" style="color: var(--oly-text);">OLY SYSTEM</span>
    </div>

    <button onclick="startFunnel()"
      class="pointer-events-auto hidden md:flex items-center gap-2 px-5 py-2.5 rounded-full text-xs font-bold uppercase tracking-wider transition-all shadow-sm hover:brightness-110"
      style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); color: rgba(255,255,255,0.75);">
      Empieza Ahora <i data-lucide="arrow-right" class="w-3 h-3"></i>
    </button>
  </nav>

  <!-- HERO SECTION -->
  <section id="hero-section" class="relative min-h-[90vh] flex flex-col items-center justify-center px-4 md:px-6 pt-32 pb-20 z-10">
    <div class="max-w-5xl w-full text-center space-y-8 md:space-y-12">

      <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full mercury-glass-panel text-[10px] md:text-xs font-bold tracking-[0.2em] uppercase shadow-lg"
           style="color: var(--oly-text-3); border-color: rgba(249,115,22,0.18);">
        <span class="relative flex h-2 w-2">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75" style="background: rgba(249,115,22,0.35);"></span>
          <span class="relative inline-flex rounded-full h-2 w-2" style="background: var(--oly-orange);"></span>
        </span>
        Guía de Escalamiento 2025: Volumen Masivo
      </div>

      <h1 class="text-[40px] sm:text-6xl md:text-[85px] font-[800] tracking-tighter leading-[0.95] md:leading-[0.9] mercury-text">
        ¿Saturado con <span class="italic font-bold" style="color: rgba(255,255,255,0.96);">+500 mensajes</span> al día por WhatsApp?
      </h1>

      <p class="text-lg md:text-2xl max-w-3xl mx-auto leading-relaxed font-medium px-2" style="color: var(--oly-text-2);">
        Descubre cómo las empresas de alto rendimiento filtran, atienden y cierran ventas en automático usando
        <span class="font-bold border-b-2" style="color: rgba(255,255,255,0.92); border-color: rgba(249,115,22,0.35);">asistentes de IA 24/7</span>.
      </p>

      <!-- SECCIÓN: IDEAL PARA -->
      <div class="space-y-6 py-4 animate-in fade-in duration-1000 delay-600">
        <p class="text-[10px] font-black uppercase tracking-[0.3em]" style="color: rgba(255,255,255,0.45);">
          Ideal para negocios con +200 msjs/día:
        </p>

        <div class="flex flex-wrap justify-center gap-3 md:gap-4 max-w-4xl mx-auto px-4">
          <div class="ideal-badge px-4 py-2 rounded-xl text-[11px] md:text-xs font-bold flex items-center gap-2">
            <i data-lucide="hospital" class="w-3 h-3" style="color: var(--oly-orange);"></i> Clínicas Especializadas
          </div>
          <div class="ideal-badge px-4 py-2 rounded-xl text-[11px] md:text-xs font-bold flex items-center gap-2">
            <i data-lucide="building-2" class="w-3 h-3" style="color: var(--oly-orange);"></i> Inmobiliarias
          </div>
          <div class="ideal-badge px-4 py-2 rounded-xl text-[11px] md:text-xs font-bold flex items-center gap-2">
            <i data-lucide="shopping-cart" class="w-3 h-3" style="color: var(--oly-orange);"></i> E-commerce de Alto Ticket
          </div>
          <div class="ideal-badge px-4 py-2 rounded-xl text-[11px] md:text-xs font-bold flex items-center gap-2">
            <i data-lucide="graduation-cap" class="w-3 h-3" style="color: var(--oly-orange);"></i> Institutos y Academias
          </div>
          <div class="ideal-badge px-4 py-2 rounded-xl text-[11px] md:text-xs font-bold flex items-center gap-2">
            <i data-lucide="car" class="w-3 h-3" style="color: var(--oly-orange);"></i> Concesionarias
          </div>
          <div class="ideal-badge px-4 py-2 rounded-xl text-[11px] md:text-xs font-bold flex items-center gap-2">
            <i data-lucide="briefcase" class="w-3 h-3" style="color: var(--oly-orange);"></i> Servicios de Consultoría
          </div>
        </div>
      </div>

      <div class="pt-4 flex flex-col items-center gap-8">
        <button onclick="startFunnel()"
          class="group relative inline-flex items-center gap-4 px-10 md:px-16 py-6 md:py-8 btn-mercury rounded-[2rem] font-bold text-xl md:text-2xl active:scale-95 w-full md:w-auto justify-center">
          Obtener el Protocolo
          <i data-lucide="zap" class="w-6 h-6 fill-white group-hover:scale-125 transition-transform"></i>
        </button>

        <div class="flex flex-wrap justify-center items-center gap-8 text-[10px] font-bold uppercase tracking-[0.2em]" style="color: rgba(255,255,255,0.45);">
          <span class="flex items-center gap-2"><i data-lucide="clock" class="w-4 h-4"></i> Lectura de 3 min</span>
          <span class="flex items-center gap-2"><i data-lucide="check-circle" class="w-4 h-4" style="color: var(--oly-orange);"></i> Implementación Inmediata</span>
          <span class="flex items-center gap-2"><i data-lucide="lock" class="w-4 h-4"></i> Método Privado</span>
        </div>
      </div>
    </div>
  </section>

  <!-- METRICS SECTION -->
  <section class="max-w-6xl mx-auto px-6 py-20">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8">
      <div class="p-6 rounded-[2rem] mercury-glass-panel text-center">
        <div class="text-3xl md:text-4xl font-black mb-1" style="color: rgba(255,255,255,0.95);">98%</div>
        <div class="text-[10px] font-bold uppercase tracking-widest" style="color: rgba(255,255,255,0.45);">Tasa de Respuesta</div>
      </div>
      <div class="p-6 rounded-[2rem] mercury-glass-panel text-center">
        <div class="text-3xl md:text-4xl font-black mb-1" style="color: rgba(255,255,255,0.95);">24/7</div>
        <div class="text-[10px] font-bold uppercase tracking-widest" style="color: rgba(255,255,255,0.45);">Operación IA</div>
      </div>
      <div class="p-6 rounded-[2rem] mercury-glass-panel text-center">
        <div class="text-3xl md:text-4xl font-black mb-1" style="color: rgba(255,255,255,0.95);">-70%</div>
        <div class="text-[10px] font-bold uppercase tracking-widest" style="color: rgba(255,255,255,0.45);">Carga Humana</div>
      </div>
      <div class="p-6 rounded-[2rem] mercury-glass-panel text-center">
        <div class="text-3xl md:text-4xl font-black mb-1" style="color: rgba(255,255,255,0.95);">+45%</div>
        <div class="text-[10px] font-bold uppercase tracking-widest" style="color: rgba(255,255,255,0.45);">Conversión</div>
      </div>
    </div>
  </section>

  <!-- CONTENT SECTION: WHY IT WORKS -->
  <section class="max-w-5xl mx-auto px-6 py-24 space-y-24">
    <div class="grid md:grid-cols-2 gap-16 items-center">
      <div class="space-y-6">
        <span class="font-bold uppercase text-xs tracking-widest" style="color: var(--oly-orange);">El Problema</span>
        <h2 class="text-4xl md:text-5xl font-black tracking-tighter leading-tight" style="color: rgba(255,255,255,0.94);">
          Tu equipo humano tiene un límite biológico.
        </h2>
        <p class="text-lg leading-relaxed" style="color: rgba(255,255,255,0.68);">
          Cuando el volumen supera los 200 mensajes diarios, el error humano es inevitable: respuestas lentas,
          prospectos olvidados y un equipo quemado que odia sonar el teléfono.
        </p>

        <ul class="space-y-4 pt-4">
          <li class="flex items-start gap-3">
            <i data-lucide="x-circle" class="w-6 h-6 mt-1 shrink-0" style="color: rgba(234,88,12,0.70);"></i>
            <span class="font-medium" style="color: rgba(255,255,255,0.78);">Pérdida de leads por falta de inmediatez.</span>
          </li>
          <li class="flex items-start gap-3">
            <i data-lucide="x-circle" class="w-6 h-6 mt-1 shrink-0" style="color: rgba(234,88,12,0.70);"></i>
            <span class="font-medium" style="color: rgba(255,255,255,0.78);">Respuestas inconsistentes que dañan la marca.</span>
          </li>
          <li class="flex items-start gap-3">
            <i data-lucide="x-circle" class="w-6 h-6 mt-1 shrink-0" style="color: rgba(234,88,12,0.70);"></i>
            <span class="font-medium" style="color: rgba(255,255,255,0.78);">Altos costos en nómina de atención básica.</span>
          </li>
        </ul>
      </div>

      <div class="relative">
        <div class="absolute inset-0 blur-3xl rounded-full opacity-30 -z-10"
             style="background: radial-gradient(circle, rgba(249,115,22,0.22) 0%, rgba(249,115,22,0) 70%);"></div>

        <div class="p-8 md:p-12 rounded-[3rem] border shadow-2xl space-y-6"
             style="background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.10); box-shadow: var(--oly-shadow-2);">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-full" style="background: var(--oly-accent-gradient);"></div>
            <div class="h-4 w-32 rounded-full" style="background: rgba(255,255,255,0.08);"></div>
          </div>

          <div class="space-y-3">
            <div class="h-12 w-full rounded-2xl rounded-tl-none border p-4 text-[10px] font-medium flex items-center"
                 style="background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.10); color: rgba(255,255,255,0.62);">
              Hola, ¿precio del servicio?
            </div>

            <div class="h-12 w-3/4 rounded-2xl rounded-tr-none ml-auto p-4 flex items-center justify-between"
                 style="background: var(--oly-accent-gradient);">
              <div class="h-2 w-20 rounded-full animate-pulse" style="background: rgba(255,255,255,0.22);"></div>
              <i data-lucide="check-check" class="w-3 h-3" style="color: rgba(255,255,255,0.92);"></i>
            </div>
          </div>

          <div class="text-center text-[10px] font-bold uppercase tracking-widest pt-4" style="color: rgba(255,255,255,0.50);">
            IA respondiendo en <span style="color: var(--oly-orange);">0.8 segundos</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FUNNEL SECTION (MODAL) -->
  <section id="funnel-section" class="fixed inset-0 z-50 hidden justify-center items-start overflow-y-auto pt-10 pb-20"
           style="background: rgba(0,0,0,0.45); backdrop-filter: blur(28px);">
    <div class="max-w-2xl w-full px-4">
      <!-- Modal Header -->
      <div class="flex justify-between items-center mb-8 px-2">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-xl flex items-center justify-center"
               style="background: var(--oly-accent-gradient); box-shadow: var(--oly-accent-glow);">
            <i data-lucide="file-text" class="text-white w-5 h-5"></i>
          </div>
          <span class="font-extrabold text-[10px] tracking-widest uppercase" style="color: rgba(255,255,255,0.86);">Protocolo Oly System</span>
        </div>

        <button onclick="closeFunnel()"
                class="w-10 h-10 rounded-full flex items-center justify-center transition-colors"
                style="background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10); color: rgba(255,255,255,0.70);">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <!-- Progress Bar -->
      <div id="progress-container" class="mb-10 px-2">
        <div class="flex items-center justify-between mb-4 font-bold text-[10px] tracking-widest uppercase"
             style="color: rgba(255,255,255,0.50);">
          <span id="step-indicator">Cargando...</span>
          <span style="color: rgba(255,255,255,0.78);">Configuración Personalizada</span>
        </div>

        <div class="h-2 rounded-full overflow-hidden" style="background: rgba(255,255,255,0.08);">
          <div id="progress-bar" class="h-full transition-all duration-700 ease-out"
               style="width:0%; background: var(--oly-accent-gradient);"></div>
        </div>
      </div>

      <!-- Content Card -->
      <div id="main-card" class="mercury-glass-panel rounded-[3rem] min-h-[500px] flex flex-col overflow-hidden shadow-2xl"
           style="background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.10);">
        <div id="content-area" class="p-8 md:p-16 flex-grow step-transition">
          <!-- Dinámico vía JS -->
        </div>

        <!-- Footer Navigation -->
        <div id="footer-nav" class="p-6 md:p-8 border-t flex items-center justify-between"
             style="background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.08);">
          <button id="btn-back"
                  class="hidden flex items-center gap-2 font-bold text-[10px] uppercase tracking-widest transition-colors"
                  style="color: rgba(255,255,255,0.55);">
            <i data-lucide="arrow-left" class="w-4 h-4"></i> Atrás
          </button>

          <div id="back-spacer" class="w-10"></div>

          <button id="btn-next" disabled
                  class="group flex items-center gap-3 px-8 md:px-12 py-4 md:py-5 rounded-2xl font-bold transition-all text-[10px] uppercase tracking-widest">
            <span id="next-text">Siguiente</span>
            <i data-lucide="chevron-right" class="w-4 h-4"></i>
          </button>
        </div>
      </div>

      <p class="mt-8 text-center text-[9px] font-bold uppercase tracking-widest" style="color: rgba(255,255,255,0.45);">
        Tu información está protegida bajo estándares de cifrado de 256 bits.
      </p>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="py-20 text-center border-t" style="border-color: rgba(255,255,255,0.08);">
    <div class="flex justify-center gap-8 mb-8 opacity-40" style="color: rgba(255,255,255,0.72);">
      <i data-lucide="shield-check" class="w-5 h-5"></i>
      <i data-lucide="globe" class="w-5 h-5"></i>
      <i data-lucide="award" class="w-5 h-5"></i>
    </div>

    <div class="text-[10px] font-bold uppercase tracking-[0.4em] opacity-80" style="color: rgba(255,255,255,0.52);">
      &copy; 2025 Oly System. Inteligencia Operativa de Alto Impacto.
    </div>
  </footer>

  <script>
    let currentStep = 1;
    const totalSteps = 5;
    let detectedPrefix = "";

    const webhookUrl = "https://n8n.automatizacionagencia.online/webhook/7c9f84fd-f27c-4f7a-bcaa-677ac13bc093";
    const formData = { nombre: '', email: '', telefono: '', mensajesDiarios: '', inversionMensual: '' };

    const optionsMensajes = ["1 a 100 /Día", "100 a 200 /Día", "200 a 500 / Día", "+500 /Día"];
    const optionsInversion = ["0 a 500 USD /Mes", "500 a 1000 USD /Mes", "1000 A 2000 USD /Mes", "+2000 USD /Mes"];

    const funnelSection = document.getElementById('funnel-section');
    const contentArea = document.getElementById('content-area');
    const progressBar = document.getElementById('progress-bar');
    const stepIndicator = document.getElementById('step-indicator');
    const btnBack = document.getElementById('btn-back');
    const btnNext = document.getElementById('btn-next');
    const nextText = document.getElementById('next-text');
    const backSpacer = document.getElementById('back-spacer');

    async function detectCountryCode() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        if (data.country_calling_code) detectedPrefix = data.country_calling_code;
      } catch (e) { console.warn("GeoIP check failed"); }
    }

    function startFunnel() {
      funnelSection.classList.remove('hidden');
      funnelSection.classList.add('flex');
      document.body.style.overflow = 'hidden';
      renderStep();
      updateNav();
    }

    function closeFunnel() {
      funnelSection.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    function isStepValid() {
      switch(currentStep) {
        case 1: return formData.nombre.trim().length > 2;
        case 2: return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email);
        case 3: return formData.telefono.trim().length > 7;
        case 4: return formData.mensajesDiarios !== '';
        case 5: return formData.inversionMensual !== '';
        default: return false;
      }
    }

    function updateNav() {
      if (currentStep > 1) {
        btnBack.classList.remove('hidden');
        backSpacer.classList.add('hidden');
      } else {
        btnBack.classList.add('hidden');
        backSpacer.classList.remove('hidden');
      }

      nextText.innerText = currentStep === totalSteps ? 'Obtener Protocolo' : 'Siguiente';

      if (isStepValid()) {
        btnNext.disabled = false;
        btnNext.classList.remove('bg-slate-100', 'text-slate-300', 'cursor-not-allowed');
        btnNext.classList.add('btn-mercury', 'text-white', 'shadow-lg');
        btnNext.style.boxShadow = "var(--oly-accent-glow)";
      } else {
        btnNext.disabled = true;
        btnNext.classList.add('bg-slate-100', 'text-slate-300', 'cursor-not-allowed');
        btnNext.classList.remove('btn-mercury', 'text-white', 'shadow-lg');
        btnNext.style.boxShadow = "none";
      }

      progressBar.style.width = `${(currentStep / totalSteps) * 100}%`;
      stepIndicator.innerText = `Paso ${currentStep} de ${totalSteps}`;
    }

    async function handleNext() {
      if (!isStepValid()) return;
      if (currentStep < totalSteps) {
        transition(() => { currentStep++; renderStep(); });
      } else {
        btnNext.disabled = true;
        nextText.innerText = "Procesando...";
        try {
          await fetch(webhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });
          showSuccess();
        } catch (e) {
          showSuccess(); // Fallback UI
        }
      }
    }

    function handleBack() {
      if (currentStep > 1) {
        transition(() => { currentStep--; renderStep(); });
      }
    }

    function transition(callback) {
      contentArea.style.opacity = '0';
      contentArea.style.transform = 'translateY(10px)';
      setTimeout(() => {
        callback();
        updateNav();
        contentArea.style.opacity = '1';
        contentArea.style.transform = 'translateY(0)';
        lucide.createIcons();
      }, 300);
    }

    function renderStep() {
      const titles = [
        ["Bienvenido", "¿Cuál es tu nombre completo?"],
        ["Siguiente Paso", "¿A qué email profesional enviamos el Protocolo?"],
        ["Seguridad", "Tu WhatsApp (para validar acceso)"],
        ["Diagnóstico", "¿Cuántos mensajes recibes al día?"],
        ["Finalización", "¿Cuánto inviertes hoy en atención al cliente?"]
      ];
      const [subtitle, title] = titles[currentStep - 1];

      let html = `
        <div class="space-y-8">
          <div class="space-y-3">
            <span class="font-bold uppercase text-[9px] tracking-widest" style="color: rgba(255,255,255,0.45);">${subtitle}</span>
            <h2 class="text-3xl md:text-5xl font-black leading-[1.1] tracking-tighter" style="color: rgba(255,255,255,0.92);">${title}</h2>
          </div>`;

      if (currentStep <= 3) {
        const names = ["nombre", "email", "telefono"];
        const placeholders = ["Escribe aquí...", "correo@empresa.com", "+52 ..."];
        const icons = ["user", "mail", "phone"];

        if (currentStep === 3 && !formData.telefono && detectedPrefix) formData.telefono = detectedPrefix + " ";

        html += `
          <div class="relative group">
            <div class="absolute left-6 top-1/2 -translate-y-1/2 transition-colors" style="color: rgba(255,255,255,0.35);">
              <i data-lucide="${icons[currentStep-1]}" class="w-6 h-6"></i>
            </div>
            <input type="text" id="input-field" placeholder="${placeholders[currentStep-1]}" value="${formData[names[currentStep-1]]}"
              class="w-full glass-input rounded-[1.5rem] pl-16 pr-8 py-6 text-xl md:text-2xl focus:outline-none font-bold shadow-inner">
          </div>`;
      } else {
        const opts = currentStep === 4 ? optionsMensajes : optionsInversion;
        const field = currentStep === 4 ? 'mensajesDiarios' : 'inversionMensual';

        html += `
          <div class="grid gap-4">
            ${opts.map(opt => `
              <button onclick="selectOption('${field}', '${opt}')"
                class="p-5 md:p-6 rounded-[1.5rem] border bg-transparent text-left transition-all flex items-center justify-between group hover:shadow-lg ${formData[field] === opt ? 'active-option' : ''}"
                style="border-color: rgba(255,255,255,0.10); background: rgba(255,255,255,0.04);">
                <span class="text-lg font-bold" style="color: ${formData[field] === opt ? 'rgba(255,255,255,0.92)' : 'rgba(255,255,255,0.62)'}">${opt}</span>
                <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors"
                  style="border-color: ${formData[field] === opt ? 'rgba(249,115,22,0.70)' : 'rgba(255,255,255,0.18)'}; background: ${formData[field] === opt ? 'rgba(249,115,22,0.25)' : 'transparent'};">
                  ${formData[field] === opt ? '<div class="w-2 h-2 bg-white rounded-full"></div>' : ''}
                </div>
              </button>
            `).join('')}
          </div>`;
      }

      contentArea.innerHTML = html + `</div>`;

      const input = document.getElementById('input-field');
      if (input) {
        input.focus();
        input.addEventListener('input', (e) => {
          formData[["nombre", "email", "telefono"][currentStep-1]] = e.target.value;
          updateNav();
        });
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') handleNext();
        });
      }
    }

    window.selectOption = function(field, value) {
      formData[field] = value;
      renderStep();
      updateNav();
      setTimeout(() => handleNext(), 400);
    }

    function showSuccess() {
      funnelSection.innerHTML = `
        <div class="max-w-xl w-full mx-auto text-center space-y-12 p-8 animate-in fade-in slide-in-from-bottom-8 duration-1000">
          <div class="w-24 h-24 rounded-[2.5rem] shadow-2xl flex items-center justify-center mx-auto"
               style="background: var(--oly-accent-gradient); box-shadow: var(--oly-accent-glow-2);">
            <i data-lucide="check" class="w-12 h-12 text-white"></i>
          </div>
          <div class="space-y-4">
            <h2 class="text-4xl md:text-6xl font-black tracking-tighter" style="color: rgba(255,255,255,0.94);">Acceso Concedido.</h2>
            <p class="text-lg md:text-xl font-semibold leading-relaxed" style="color: rgba(255,255,255,0.70);">
              El Protocolo de Escalamiento está viajando ahora mismo a
              <span style="color: rgba(255,255,255,0.92); text-decoration: underline;">${formData.email}</span>.
            </p>
          </div>
          <div class="mercury-glass-panel rounded-[2rem] p-8 text-left space-y-4 w-full"
               style="border-color: rgba(249,115,22,0.20);">
            <div class="flex items-center gap-4 font-bold" style="color: rgba(255,255,255,0.78);">
              <div class="w-8 h-8 rounded-full flex items-center justify-center"
                   style="background: rgba(249,115,22,0.16); color: rgba(255,255,255,0.92);">
                <i data-lucide="mail" class="w-4 h-4"></i>
              </div>
              Revisa tu bandeja de entrada o SPAM.
            </div>
            <div class="flex items-center gap-4 font-bold" style="color: rgba(255,255,255,0.78);">
              <div class="w-8 h-8 rounded-full flex items-center justify-center"
                   style="background: rgba(249,115,22,0.16); color: rgba(255,255,255,0.92);">
                <i data-lucide="message-circle" class="w-4 h-4"></i>
              </div>
              Te llegara una confirmación a tu número en WhatsApp.
            </div>
          </div>
          <button onclick="window.location.reload()" class="w-full py-6 btn-mercury rounded-2xl font-black text-xl shadow-2xl">
            Listo..
          </button>
        </div>`;
      lucide.createIcons();
    }

    // Initialize
    detectCountryCode();
    lucide.createIcons();
    btnNext.addEventListener('click', handleNext);
    btnBack.addEventListener('click', handleBack);
  </script>
</body>
</html>
